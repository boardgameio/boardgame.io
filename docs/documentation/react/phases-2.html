<!DOCTYPE html>
<html>

<head>
<style>
body {
  padding: 20px;
  font-family: monospace;
}
.msg {
  position: absolute;
  bottom: 0;
  left: 20px;
  color: #aaa;
  font-size: 12px;
  margin-bottom: 20px;
}
.container {
  display: flex;
  flex-direction: row;
  justify-content: space-evenly;
}
.deck {
  width: 40px;
  height: 60px;
  margin-left: auto;
  margin-right: auto;
  border: 1px solid #ddd;
  padding: 20px;
  text-align: center;
  border-radius: 5px;
  margin-bottom: 50px;
}
.client {
  border-radius: 5px;
  width: 100px;
  border: 1px solid #ddd;
  background: #fafafa;
  opacity: .8;
}
.client.active {
  box-shadow: 0 0 5px #aaa;
  background: #fff;
  opacity: 1;
}
.client li {
  list-style: none;
  padding: 5px;
  height: 30px;
  line-height: 30px;
  text-align: center;
}
</style>
</head>

<body>
  <div id="app"></div>

  <script type="text/babel">
function DrawCard(G, ctx) {
  G.deck--;
  G.hand[ctx.currentPlayer]++;
}

function PlayCard(G, ctx) {
  G.deck++;
  G.hand[ctx.currentPlayer]--;
}

const game = {
  setup: (ctx) => ({ deck: 6, hand: Array(ctx.numPlayers).fill(0) }),
  phases: {
    draw: {
      moves: { DrawCard },
      endIf: G => (G.deck <= 0),
      start: true,
      next: 'play',
    },
    play: {
      moves: { PlayCard },
    }
  },
  turn: { moveLimit: 1 },
};

const Deck = ({ G, ctx }) => (
  <div className="deck">
    <div>{G.deck}</div>
    <div>cards</div>
    <div style={{ fontSize: "1.2em", marginTop: 20, color: '#aaa' }}>{ctx.phase}</div>
  </div>
);

class Board extends React.Component {
  DrawCard = () => {
    this.props.moves.DrawCard();
  }

  PlayCard = () => {
    this.props.moves.PlayCard();
  }

  render() {
    const { playerID, isActive } = this.props;
    if (!playerID) return <Deck {...this.props} />;
    let c = "client";
    if (isActive) {
      c += " active";
    }
    return (
      <div className={c}>
        <li><strong>Player { playerID }</strong></li>
        <li>{ this.props.G.hand[playerID] } cards</li>
        <li><button id="take" onClick={this.DrawCard}>Draw Card</button></li>
        <li><button id="play" onClick={this.PlayCard}>Play Card</button></li>
      </div>
    );
  }
}

const Client = BoardgameIO.ReactClient({
  game,
  board: Board,
  debug: false,
  numPlayers: 3,
  multiplayer: { local: true },
});

const App = () => (
  <div>
    <div style={{ width: '100%' }}>
      <Client />
    </div>
    <div className="container">
      <Client playerID="0" />
      <Client playerID="1" />
      <Client playerID="2" />
    </div>
  </div>
);

ReactDOM.render(<App/>, document.getElementById('app'));
  </script>

  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="//unpkg.com/react@next/umd/react.development.js"></script>
  <script src="//unpkg.com/react-dom@next/umd/react-dom.development.js"></script>
  <script src="boardgameio.min.js"></script>
</body>

</html>
